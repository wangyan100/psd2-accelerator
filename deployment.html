<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<meta name="author" content="Sandbox Team">
<title>Deployment Documentation</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:initial}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px 0}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:.4em .75em 0 .75em;line-height:1;vertical-align:top}
.colist>table tr>td:first-of-type img{max-width:initial}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
</head>
<body class="article">
<div id="header">
<h1><span class="image"><img src="./images/logo/psd2-accelerator.svg" alt="PSD2 Accelerator" width="120"></span> Deployment Documentation</h1>
<div class="details">
<span id="author" class="author">Sandbox Team</span><br>
<span id="email" class="email"><a href="mailto:psd2-sandbox@adorsys.de">psd2-sandbox@adorsys.de</a></span><br>
<span id="revnumber">version ,</span>
<span id="revdate">2019-03-25</span>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#section-deployment-view">1. Deployment View</a>
<ul class="sectlevel2">
<li><a href="#_adorsys_sample_setup">1.1. adorsys Sample Setup</a></li>
<li><a href="#_release_artifacts">1.2. Release Artifacts</a></li>
<li><a href="#_configuration">1.3. Configuration</a></li>
<li><a href="#_deploy_on_your_own_infrastructure">1.4. Deploy on Your Own Infrastructure</a></li>
<li><a href="#_reset_sandbox_data">1.5. Reset Sandbox Data</a></li>
<li><a href="#_build_pipeline">1.6. Build Pipeline</a></li>
<li><a href="#_deployment_samples">1.7. Deployment Samples</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<style>
.arc42help {font-size:small; width: 14px; height: 16px; overflow: hidden; position: absolute; right: 0px; padding: 2px 0px 3px 2px;}
.arc42help::before {content: "?";}
.arc42help:hover {width:auto; height: auto; z-index: 100; padding: 10px;}
.arc42help:hover::before {content: "";}
@media print {
	.arc42help {display:hidden;}
}
h1 span img {vertical-align: baseline; margin-right: 10px}
</style>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="section-deployment-view">1. Deployment View</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_adorsys_sample_setup">1.1. adorsys Sample Setup</h3>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./images/deployment-view.svg" alt="Deployment View" width="100%">
</div>
<div class="title">Figure 1. deployment-view</div>
</div>
<div class="paragraph">
<p>The PSD2 Accelerator consists of two deployments. The <em>sandbox</em> itself provides the XS2A API and a web application (and its API) for the developer portal. These two components are provided by a single fat JAR but served on different ports. XS2A is hosted on port <code>:8080</code> and the <em>developer portal</em> is hosted on port <code>:8081</code> (both configurable). XS2A needs access to a database to persist the Consent Management state. The configuration for the <em>sandbox</em> is completely externalized (see <a href="#_configuration">Configuration</a>).</p>
</div>
<hr>
<div class="paragraph">
<p>The <em>ssl-proxy</em> deployment is responsible for <a href="#SSL Client Authentication">[SSL Client Authentication]</a> required by XS2A. It forwards the certificate body to the <em>sandbox</em> in an HTTP header (<code>tpp-qwac-certificate</code>). So SSL termination has to happen here, at least for the XS2A API part. The <em>ssl-proxy</em> only validates the SSL client certificate because certain parts of the API are accessible without authentication (e.g. the Swagger file and Swagger UI).<br>
The <em>sandbox</em> acts as a Certificate Authority (CA) and provides SSL Client Certificates to the TPP developers. The <em>ssl-proxy</em> needs access to the <em>sandbox</em> CA certificate in order to verify the TPP SSL client certificates (see <a href="#_configuration">Configuration</a>).</p>
</div>
<div class="paragraph">
<p><em>ssl_proxy</em> listens on <code>:8443</code> (actual reverse proxy) and <code>:8090</code> (health check).</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
The supplied <em>ssl-proxy</em> is only meant to be used in development and must be substituted by an equivalent infrastructure component in prod (see <a href="#_deploy_on_your_own_infrastructure">Deploy on Your Own Infrastructure</a>).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In our own setup on OpenShift both components of the <em>sandbox</em> are available on different subdomains. The OpenShift loadbalancer terminates SSL for the <em>developer portal</em> and does SSL passthrough for the <em>XS2A</em> API so that the <em>ssl-proxy</em> can terminate SSL itself.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In reality all (SSL) traffic get passed through the Load Balancer to the <em>ssl-proxy</em>. The <em>ssl-proxy</em> then does SSL termination <strong>for both endpoints</strong>  but SSL client authentication only for the XS2A API. We need this so we can start the exact same setup as on OpenShift with docker-compose for local development. <em>This is not a good idea for production.</em>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_release_artifacts">1.2. Release Artifacts</h3>
<div class="paragraph">
<p>We use <a href="https://github.com/adorsys/psd2-accelerator/releases">GitHub Releases</a> to publish our release notes, the Sandbox JAR and its SHA1 checksum.</p>
</div>
<div class="paragraph">
<p>Docker Images are released to <a href="https://hub.docker.com/u/adorsys">adorsys DockerHub account</a>.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Artifact</th>
<th class="tableblock halign-left valign-top">Image Name</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sandbox</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">adorsys/psd2-sandbox:1.5.0-SNAPSHOT</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ssl-proxy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">adorsys/psd2-sandbox-ssl-proxy:1.5.0-SNAPSHOT</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">$ docker run -it --rm -v $PWD:/target adorsys/psd2-sandbox:1.5.0-SNAPSHOT sh -c "cp /opt/app-root/src/*.jar /target"</code></pre>
</div>
</div>
<div class="paragraph">
<p>To build your own Docker images get the JAR from our image or use Docker Multi Stage Builds:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Dockerfile" data-lang="Dockerfile">FROM openjdk:8

COPY --from=adorsys/psd2-sandbox:1.5.0-SNAPSHOT /opt/app-root/src/sandbox-1.5.0-SNAPSHOT.jar .

CMD java -jar sandbox-1.5.0-SNAPSHOT.jar</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration">1.3. Configuration</h3>
<div class="paragraph">
<p>Configuration is done via <a href="https://docs.spring.io/spring-boot/docs/1.5.18.RELEASE/reference/htmlsingle/#boot-features-external-config">Spring Boot Externalized Configuration</a> and can be set via CLI arg, system property or environment variable. Since we intensively use Docker in our setup and environment variables are the idiomatic approach to configuration there, we stick to environment variables in the examples.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Spring Boot automatically translates properties to environment variables. The environment variable <code>SPRING_DATASOURCE_URL</code> sets the property <code>spring.datasource.url</code>. Consult the <a href="https://docs.spring.io/spring-boot/docs/1.5.18.RELEASE/reference/htmlsingle/#boot-features-external-config-application-property-files">Spring Boot documentation</a> for more information.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_sandbox">1.3.1. Sandbox</h4>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BANK_PROFILE_PATH</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>File path to the customized <code>bank_profile.yml</code>.</p>
</div>
<div class="paragraph">
<p>Possible values could be <code>bank_profile.yml</code> (relative) or <code>/mnt/my_bank_profile.yml</code></p>
</div>
<div class="paragraph">
<p>This is the actual business configuration reflecting the PSD2 features your bank offers. You can find the relevant documentation for this file at the <a href="https://github.com/adorsys/xs2a/blob/1.11/aspsp-profile/README.md">XS2A GitHub Project</a>.</p>
</div>
<div class="paragraph">
<p>For an example and the actual default values used in the sandbox see the <a href="#sample-bank-profile">Sample bank_profile.yml</a> below.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Points to the default <code>bank_profile.yml</code> YML embedded in the application</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SANDBOX_TESTDATA_TRANSACTIONS_PATH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path and filename of the custom transaction data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Points to the default <code>transactions_dump.csv</code> CSV embedded in the application</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SANDBOX_TESTDATA_USD_ENABLED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables/Disables the account with the currency US-Dollar of PSU-Successful.</p>
<p class="tableblock">Possible values are: <em>true</em> or <em>false</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CERTIFICATE_FILTER</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Set to the format of the QWAC certificate in the <code>tpp-qwac-certificate</code> header. This value depends on your SSL-Proxy configuration. Possible values are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>default</em> for <a href="https://en.wikipedia.org/wiki/Privacy-Enhanced_Mail">PEM</a> format without line breaks. Also known as "base64" format of the certificate.</p>
</li>
<li>
<p><em>tab</em> for <a href="https://en.wikipedia.org/wiki/Privacy-Enhanced_Mail">PEM</a> format with tabs (<code>\t</code>) instead of line breaks</p>
</li>
<li>
<p><em>mock</em> disables the QWAC authentication and uses a hard coded test certificate instead (<strong>do not use in prod!</strong>)</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>tab</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SANDBOX_FEATURE_UI_ENABLED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables/Disables the Sandbox UI.</p>
<p class="tableblock"> Possible values are: <em>true</em> or <em>false</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPRING_DATASOURCE_PASSWORD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DB password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>(not set)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPRING_DATASOURCE_URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JDBC URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>(not set)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPRING_DATASOURCE_USERNAME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DB username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>(not set)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPRING_JPA_PROPERTIES_HIBERNATE_DEFAULT_SCHEMA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DB schema name (depends on used DB and configuration)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>(not set)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SANDBOX_FEATURE_UI_CERTPAGE_ENABLED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables/Disables the certificate page in the ui</p>
<p class="tableblock">Possible values are: <em>true</em> or <em>false</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SANDBOX_UI_CONTACT_MAILTO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contact email address</p>
<p class="tableblock"> Format: <em>mailto:YOUR@MAILADRESS.DE</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="mailto:psd2@adorsys.de">psd2@adorsys.de</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SANDBOX_UI_LOGO_URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL to customized ui logo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Points to the default psd2-accelerator logo embedded in the application</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SANDBOX_UI_CONTENT_URLS_DE_CERT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL to customized german markdown file for certificate page</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Points to the default german <code>create-cert-page.md</code> embedded in the application</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SANDBOX_UI_CONTENT_URLS_DE_FAQ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL to customized german markdown file for faq page</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Points to the default german <code>faq-page.md</code> embedded in the application</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SANDBOX_UI_CONTENT_URLS_DE_PORTAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL to customized german markdown file for portal page</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Points to the default german <code>developer-portal-page.md</code> embedded in the application</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SANDBOX_UI_CONTENT_URLS_EN_CERT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL to customized english markdown file for certificate page</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Points to the default english <code>create-cert-page.md</code> embedded in the application</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SANDBOX_UI_CONTENT_URLS_EN_FAQ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL to customized english markdown file for faq page</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Points to the default english <code>faq-page.md</code> embedded in the application</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SANDBOX_UI_CONTENT_URLS_EN_PORTAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL to customized english markdown file for portal page</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Points to the default english <code>developer-portal-page.md</code> embedded in the application</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LOGGING_CONFIG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Location of the logback configuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>classpath:logback.xml</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CONSOLE_LOG_PATTERN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sandbox log pattern (note: <code>logging.pattern.console</code> if not as ENV)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>[%-5level][%d{HH:mm:ss.SSS}] - %logger: %message%n%xException</em></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
It is required to enable CORS in the service which serves the customized markdown files for the UI. Otherwise the content can&#8217;t be loaded and stays empty.
</td>
</tr>
</table>
</div>
<div id="sample-bank-profile" class="listingblock">
<div class="title">Sample bank_profile.yml</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">---
setting:
  frequencyPerDay: 5
  combinedServiceIndicator: false
  scaApproaches:
    - REDIRECT
  tppSignatureRequired: false
  bankOfferedConsentSupport: true
  pisRedirectUrlToAspsp: http://localhost:8080/v1/online-banking/init/pis/{redirect-id}
  pisPaymentCancellationRedirectUrlToAspsp: http://localhost:8080/v1/online-banking/cancel/pis/{redirect-id}
  aisRedirectUrlToAspsp: http://localhost:8080/v1/online-banking/init/ais/{redirect-id}
  multicurrencyAccountLevel: SUBACCOUNT
  availableBookingStatuses:
    - BOOKED
    - PENDING
  supportedAccountReferenceFields:
    - IBAN
  consentLifetime: 0
  transactionLifetime: 0
  allPsd2Support: false
  transactionsWithoutBalancesSupported: true
  signingBasketSupported: false
  paymentCancellationAuthorizationMandated: true
  piisConsentSupported: false
  deltaReportSupported: false
  redirectUrlExpirationTimeMs: 600000
  notConfirmedConsentExpirationPeriodMs: 86400000
  notConfirmedPaymentExpirationPeriodMs: 86400000
  supportedPaymentTypeAndProductMatrix:
    SINGLE:
      - sepa-credit-transfers
    PERIODIC:
      - sepa-credit-transfers
  paymentCancellationRedirectUrlExpirationTimeMs: 600000
  availableAccountsConsentSupported: false
  scaByOneTimeAvailableAccountsConsentRequired: true
  psuInInitialRequestMandated: false</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_customizing_the_test_data">Customizing the Test Data</h5>
<div class="paragraph">
<p>The IBANs of the different PSUs we provide are configurable. There is a default configuration in place which uses a made up routing number (<strong>DE</strong>XX<strong>76036568</strong>XXXXXXXXXX).</p>
</div>
<div class="listingblock">
<div class="title">Default Test Data Configuration</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">sandbox:
  testdata:
    psus:
      "PSU-Successful":
        - DE11760365688833114935 # GIRO
        - DE13760365689669622432 # SAVINGS
        - DE07760365680034562391 # EMPTY GIRO
        - DE89760365681134661389 # NEGATIVE BALANCE GIRO
        - DE71760365681257681381 # LOWER BALANCE GIRO
        - DE56760365681650680255 # USD GIRO
      "PSU-Rejected":
        - DE06760365689827461249
      "PSU-Cancellation-Rejected":
        - DE68760365687914626923
      "PSU-Blocked":
        - DE13760365681209386222
      "PSU-InternalLimit":
        - DE91760365683491763002
      "PSU-Pending":
        - DE06760365680304199226
      "PSU-ConsentExpired":
        - DE12760365687895439876
      "PSU-ConsentRevokedByPsu":
        - DE89760365681729983660</code></pre>
</div>
</div>
<div class="paragraph">
<p>Every PSU has one or more accounts. The account order <em>does</em> matter (e.g. the first IBAN of <em>PSU-Successful</em> is always picked for the giro account). You can override the configuration by placing an edited copy in <code>$CWD/config/testdata.yml</code> next to the JAR.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Make sure that every IBAN you use is valid. We do not check externally set IBANs for correctness. If you use invalid IBANs, you might encounter problems when interacting with the XS2A API or with external systems. If a PSU has more than one IBAN, you need to supply all of them or the application won&#8217;t start. To help with configuration and debugging, the effective <code>TestDataConfiguration</code> is logged (<code>INFO</code>) to the console at startup.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Besides the IBANs it is also possible to import transaction data using a CSV file (see <a href="#propertyTable">[propertyTable]</a>). The data will then replace the transactions of the giro account of the <code>PSU_Successful</code>.</p>
</div>
<div class="paragraph">
<p>The format of the CSV file must match the following example:</p>
</div>
<div class="listingblock">
<div class="title">Default Transaction Data</div>
<div class="content">
<pre class="highlight"><code class="language-csv" data-lang="csv">bookingStatus|endToEndId|mandateId|creditorId|bookingDate|valueDate|currency|amount|creditorName|creditorIban|creditorAccountCurrency|ultimateCreditor|debtorName|debtorIban|debtorAccountCurrency|ultimateDebtor|remittanceInformationUnstructured|remittanceInformationStructured|purposeCode|bankTransactionCode|proprietaryBankTransactionCode
booked||||2018-08-12|2018-08-12|EUR|-52.93|Tankstelle Weyarn Munchener Strase 32//Weyarn/DE|DE98760365686066861064|EUR||Isabella Ionescu|DE13760365689669622432|EUR||2018-07-20T15:08 Debitk.3 2019-03|2018-07-20T15:08 Debitk.3 2019-03|OTHR|5|5
booked||||2018-08-01|2018-08-01|EUR|2500|Felix Borchert &amp; Söhne GmbH|DE22760365683809366106|EUR||Isabella Ionescu|DE13760365689669622432|EUR||Gehalt August 2018|Gehalt August 2018|OTHR|5|5
booked||||2018-02-01|2018-02-01|EUR|-17.50|CLIMBING-SOLUTIONS GMBH//Stuttgart/DE|DE43760365682351770687|EUR||Isabella Ionescu|DE13760365689669622432|EUR||2018-10-08T11:05 Debitk.3 2029-03|2018-10-08T11:05 Debitk.3 2029-03|OTHR|5|5
booked||||2018-08-18|2018-08-18|EUR|-830|Hans Schlegl|DE33760365683971994750|EUR||Isabella Ionescu|DE13760365689669622432|EUR||Miete, Grünwälderstr. 49, 2.OG rechts|Miete, Grünwälderstr. 49, 2.OG rechts|OTHR|5|5
pending|||||2019-02-01|EUR|-67|Strom-Gesellschaft Nürnberg|DE31760365686202206855|EUR||Isabella Ionescu|DE13760365689669622432|EUR||KTO 84633821 Abschlag 67,00 EUR faellig 01.08.18 Moritz-Str. 12|KTO 84633821 Abschlag 67,00 EUR faellig 01.08.18 Moritz-Str. 12|OTHR|5|5</code></pre>
</div>
</div>
<div class="paragraph">
<p>The CSV must comply with the following restrictions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The columns must be separated by <code>|</code></p>
</li>
<li>
<p>A header line is mandatory and must match the example</p>
</li>
<li>
<p>Dates must be in the ISO format (YYYY-MM-DD)</p>
</li>
<li>
<p>Payment amounts must use <code>.</code> instead of <code>,</code> as floating point separator</p>
</li>
<li>
<p>Empty lines will be skipped</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See <a href="#_configuration">Configuration</a> for more information about the Spring Boot configuration mechanism.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ssl_proxy">1.3.2. ssl-proxy</h4>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Required Properties for ssl-proxy</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">API_INTERNAL_URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Internal URL where the <em>XS2A API</em> is reachable (set in docker-compose)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="http://service:8080" class="bare">http://service:8080</a></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">API_EXTERNAL_URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">External URL where the <em>XS2A API</em> is reachable (set in docker-compose)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>api.psd2-accelerator.vcap.me</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PORTAL_INTERNAL_URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Internal URL where the <em>developer portal</em> is reachable (set in docker-compose)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="http://service:8081" class="bare">http://service:8081</a></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PORTAL_EXTERNAL_URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">External URL where the <em>developer portal</em> is reachable (set in docker-compose)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>portal.psd2-accelerator.vcap.me</code></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. Required Files for ssl-proxy</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">File</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/opt/app-root/etc/nginx.pem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSL Certificate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">self signed one from adorsys</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/opt/app-root/etc/nginx.key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PK to SSL Certificate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">random PK for the self signed certificate</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/opt/app-root/etc/ca.crt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PSD2 Accelerator CA Certificate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">default adorsys CA certificate</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The PSD2 Accelerator CA certificate (ca.crt) is already embedded in the <em>ssl-proxy</em>. If you supply your own instance of this component you need to configure the proper SSL and CA certificates there. You can get the PSD2 Accelerator CA certificate by extracting it from the <em>ssl-proxy</em> image. See <a href="#_deploy_on_your_own_infrastructure">Deploy on Your Own Infrastructure</a> for more details.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_deploy_on_your_own_infrastructure">1.4. Deploy on Your Own Infrastructure</h3>
<div class="paragraph">
<p>The PSD2 Accelerator deployment is quite flexible. The only required component is the <em>sandbox</em> and its DB.</p>
</div>
<div class="paragraph">
<p>While we release Docker images only, the <em>sandbox</em> can be run on any machine providing a recent JDK 8 (see <a href="#Technology Requirements">[Technology Requirements]</a>). See <a href="#_release_artifacts">Release Artifacts</a> to find out how to get the JAR.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
As of now we release Docker Images with a Spring Boot fat JAR with an embedded Tomcat only. We do not release the <em>sandbox</em> as a WAR (yet).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <em>ssl-proxy</em> can (and should) be substituted by existing infrastructure. There are many options which components can replace our <em>ssl-proxy</em>. Most likely it&#8217;s going to be some kind of load balancer in hardware (F5) or software (HAProxy, some API Gateway). It&#8217;s only purpose is SSL Client Authentication and forwarding the SSL Client Certificate (QWAC) in PEM format (single line or tab delimited, see <a href="#_configuration">Configuration</a>) in an HTTP header named <code>tpp-qwac-certificate</code> to the <em>sandbox</em> (see <a href="#_adorsys_sample_setup">adorsys Sample Setup</a>).</p>
</div>
<div class="paragraph">
<p>The connection between <em>sandbox</em> and any SSL-Proxy is made on the SSL-Proxy side with custom configuration. The only information that comes from the <em>sandbox</em> is the Sandbox CA Certificate (ca.crt). You will need to make this file accessible to your SSL-Proxy.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell"># copy ca.crt from the image to the current directory
$ docker run -it --rm -v $PWD:/target adorsys/psd2-sandbox-ssl-proxy:1.5.0-SNAPSHOT sh -c "cp /opt/app-root/etc/ca.crt /target"</code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#_nginx_ssl_configuration">NGINX SSL Configuration</a> for an actual sample of our NGINX configuration.</p>
</div>
<div class="sect3">
<h4 id="_technical_requirements_sizing">1.4.1. Technical Requirements / Sizing</h4>
<div class="ulist">
<ul>
<li>
<p>the <em>sandbox</em> needs a recent JDK 8 (if you aren&#8217;t using the Docker Image)</p>
</li>
<li>
<p>HA setup is possible</p>
</li>
<li>
<p>all state is shared in the DB</p>
</li>
<li>
<p>zero downtime deployments are <strong>not</strong> guaranteed (see the note about <a href="#downtime_db_migration">DB migrations</a>)</p>
</li>
<li>
<p>DB availability depends on your setup</p>
</li>
<li>
<p>supported databases (see <a href="#_use_your_own_database">Use Your Own Database</a>):</p>
<div class="ulist">
<ul>
<li>
<p>PostgreSQL 9+</p>
</li>
<li>
<p>Oracle 11g+</p>
</li>
<li>
<p>MariaDB 10+</p>
</li>
</ul>
</div>
</li>
<li>
<p>2-4 GiB RAM per <em>sandbox</em> deployment is a good starting point for prod <strong>(monitor this!)</strong></p>
</li>
<li>
<p><em>ssl-proxy</em> needs 128 - 512 MiB RAM <strong>(don&#8217;t use in prod!)</strong></p>
</li>
<li>
<p>the DB schema needs enough disk space because consents are persisted here (grows over time) <strong>(monitor this!)</strong></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_logging">1.4.2. Logging</h4>
<div class="paragraph">
<p>We use a modified <a href="https://docs.spring.io/spring-boot/docs/1.5.18.RELEASE/reference/html/howto-logging.html">Spring Boot logging configuration</a> with logback and log everything to stdout.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>FILE</code> appender is disabled</p>
</li>
<li>
<p>additional <code>access-log</code> logger which logs TPP access</p>
</li>
<li>
<p>default configuration parameters for the <code>CONSOLE</code> are supported</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The default log level is <code>INFO</code>. Set a different level with <code>LOGGING_LEVEL_ROOT=WARN</code> (global) or with <code>LOGGING_LEVEL_de.adorsys.psd2=WARN</code> (for everything below <code>de.adorsys.psd2</code>; please note the casing).</p>
</div>
<div class="paragraph">
<p>To use a custom log configuration start the PSD2 Accelerator with <code>-Dlogging.config=my-logging-config.xml</code> to use your file at <code>$CWD/my-logging-config.xml</code>. See <a href="#_configuration">Configuration</a></p>
</div>
<div class="listingblock">
<div class="title">Default Logging Configuration</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">&lt;configuration&gt;
  &lt;include resource="org/springframework/boot/logging/logback/defaults.xml"/&gt;

  &lt;include resource="org/springframework/boot/logging/logback/console-appender.xml" /&gt;

  &lt;root level="INFO"&gt;
    &lt;appender-ref ref="CONSOLE"/&gt;
  &lt;/root&gt;

  &lt;logger name="access-log" level="info" additivity="false"&gt;
    &lt;appender-ref ref="CONSOLE"/&gt;
  &lt;/logger&gt;

&lt;/configuration&gt;</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
If you use your own <code>logback.xml</code> we can&#8217;t guarantee that the default Spring Boot configuration properties still work. Please check the docs thoroughly. Have a look at the <a href="https://docs.spring.io/spring-boot/docs/1.5.18.RELEASE/reference/html/howto-logging.html">Spring Boot logging configuration</a>, the <a href="https://logback.qos.ch/manual/configuration.html">Logback Documentation</a> and our <code>logback.xml</code> to see whats possible.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_production_ready_features">1.4.3. Production Ready Features</h4>
<div class="sect4">
<h5 id="_health_checks">Health Checks</h5>
<div class="paragraph">
<p>There are health check endpoints for both deployments. They return <code>200 OK</code> when healthy.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>GET <a href="http://sandbox:8081/management/health" class="bare">http://sandbox:8081/management/health</a></code></p>
</li>
<li>
<p><code>GET <a href="http://sandbox:8080/management/health" class="bare">http://sandbox:8080/management/health</a></code></p>
</li>
<li>
<p><code>GET <a href="http://ssl-proxy:8090/healthz" class="bare">http://ssl-proxy:8090/healthz</a></code></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_using_the_actuator_features">Using the Actuator Features</h5>
<div class="paragraph">
<p>We use Spring Boot Actuator for metrics, health checks and information about the deployment. Per default there are four endpoints enabled (active on both ports).</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>GET /management/health</code> returns <code>{status: "UP"}</code> if we&#8217;re good</p>
</li>
<li>
<p><code>GET /management/info</code> returns information about</p>
<div class="ulist">
<ul>
<li>
<p>deployed version</p>
</li>
<li>
<p>git commit/tag from which it was build</p>
</li>
<li>
<p>bundled XS2A impl and spec version</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>GET /management/metrics</code> returns the default <a href="https://docs.spring.io/spring-boot/docs/1.5.18.RELEASE/reference/html/production-ready-metrics.html">Spring Actuator Metrics</a></p>
</li>
<li>
<p><code>GET /management/prometheus</code> returns the application metrics in <a href="https://prometheus.io/">Prometheus</a> format</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The actuator endpoints are all public. We do not expect any sensitive information there. Please verify this.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you want to disable certain endpoints you can do so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>endpoints.metrics.enabled=false
endpoints.health.enabled=false
endpoints.info.enabled=false
endpoints.prometheus.enabled=false</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
(KNOWN BUG) You can&#8217;t disable the endpoints with CLI arguments. System properties and environment variables work fine, though.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Disable all production ready features by not exposing <code>/management/**</code> to the public.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_use_your_own_database">1.4.4. Use Your Own Database</h4>
<div class="paragraph">
<p>We bundle a recent PostgreSQL JDBC driver in the <em>sandbox</em> JAR. For other databases you need to supply the correct JDBC driver. We use Springs <a href="https://docs.spring.io/spring-boot/docs/1.5.17.RELEASE/reference/html/executable-jar.html#executable-jar-property-launcher-features">PropertiesLauncher</a> to allow adding JARs to the classpath. The default <code>CMD</code> in our Dockerfile adds the folder <code>/opt/app-root/src/lib</code> per default. Put your JDBC driver there so it gets loaded on application start:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">$ docker run -it --rm -v $PWD/ojdbc8.jar:/opt/app-root/src/lib adorsys/psd2-sandbox:1.5.0-SNAPSHOT</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you run the <em>sandbox</em> without Docker, you need to set <code>loader.path</code> yourself:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">$ ls lib
ojdbc8.jar
# adds all JARs in "./lib" to the classpath
$ java -jar -Dloader.path="lib" sandbox-1.5.0-SNAPSHOT.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>Only databases listed in <a href="#_technical_requirements_sizing">Technical Requirements / Sizing</a> are supported. The Liquibase migration may fail with others.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Please make sure to set the right <code>SPRING_JPA_PROPERTIES_HIBERNATE_DEFAULT_SCHEMA</code> depending on your setup.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_database_migration">1.4.5. Database Migration</h4>
<div class="paragraph">
<p>There are three options to do database migration.</p>
</div>
<div id="downtime_db_migration" class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>every approach needs at least read access to the DB</p>
</li>
<li>
<p>you should scale down the deployment while migrating or requests may fail</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_automatically_with_liquibase">Automatically with Liquibase</h5>
<div class="paragraph">
<p>Set the configuration property <code>liquibase.enabled=true</code> and migration will be run automatically with the configured connection details.</p>
</div>
</div>
<div class="sect4">
<h5 id="_manually_with_liquibase">Manually with Liquibase</h5>
<div class="paragraph">
<p>The <code>sandbox-1.5.0-SNAPSHOT.jar</code> can be used as CLI application to do the migration with different credentials than the actual deployment.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ java -jar sandbox-1.5.0-SNAPSHOT.jar migrate --spring.datasource.url=$JDBC_URL --spring.datasource.username=$USR --spring.datasource.password=$PASS</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_manually_with_self_generated_sql_schema">Manually with self-generated SQL schema</h5>
<div class="paragraph">
<p>The CLI can echo the full schema instead of doing the actual migration, too. This command creates a file <code>database-migration.sql</code> which contains the SQL that Liquibase would run to update the schema.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ java -jar sandbox-1.5.0-SNAPSHOT.jar create-schema --spring.datasource.url=$JDBC_URL --spring.datasource.username=$USR --spring.datasource.password=$PASS</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_reset_sandbox_data">1.5. Reset Sandbox Data</h3>
<div class="paragraph">
<p>In a sandbox environment it is good practice to reset the data periodically to the factory-defaults. To reset the data of the PSD2 Accelerator, the following steps are needed:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Stop the running PSD2 Accelerator process by terminating the jar or by stopping the docker container.</p>
</li>
<li>
<p>Delete the database data by redeploying your database instance. The procedure of resetting the database depends on your local deployment setup. Check the documentation of your preferred database for further information.</p>
</li>
<li>
<p>Restart the PSD2 Accelerator.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_build_pipeline">1.6. Build Pipeline</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This is no longer accurate.<br>
TODO: document build with Travis CI when done.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We use <a href="https://github.com/adorsys/psd2-accelerator/pipelines">GitLab CI</a> for the pipeline. Build, release, testing, Code coverage, linting and compilation/deployment of this architecture documentation are automated. Every artifact we build is also kept for one week and can be downloaded in corresponding pipeline/job.</p>
</div>
<div class="paragraph">
<p>Every commit on master pushes images for <em>sandbox</em> and <em>ssl-proxy</em> to the adorsys OpenShift. An image change trigger then starts a new deployment. The arc42 documentation is also built on every commit and published with the <a href="http://adorsys.github.io/psd2-accelerator">GitHub Pages</a> feature.</p>
</div>
<div class="paragraph">
<p>Each tag which follows the semver pattern with a leading <code>v</code> like <code>v1.0.0</code> results in a tagged release. Tags are pushed to <a href="https://hub.docker.com/u/adorsys/">DockerHub</a> (see <a href="#_release_artifacts">Release Artifacts</a>). Releases are created locally with our <code>infrastructure/build/release.sh</code> script.</p>
</div>
</div>
<div class="sect2">
<h3 id="_deployment_samples">1.7. Deployment Samples</h3>
<div class="sect3">
<h4 id="_docker_compose">1.7.1. docker-compose</h4>
<div class="paragraph">
<p>This docker-compose setup will start the <em>sandbox</em> on port <code>:8080</code>/<code>:8081</code> and the <em>ssl-proxy</em> on port <code>:8443</code>. The <em>ssl-proxy</em> knows how to serve the domains <a href="https://portal.psd2-accelerator.vcap.me" class="bare">https://portal.psd2-accelerator.vcap.me</a> and <a href="https://api.psd2-accelerator.vcap.me" class="bare">https://api.psd2-accelerator.vcap.me</a> locally with a self signed SSL certificate.</p>
</div>
<div class="listingblock">
<div class="title">docker-compose.yml</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">version: "3.7"
services:
  service:
    build: service
    image: adorsys/psd2-sandbox
    ports:
      - "8080:8080"
      - "8081:8081"
    environment:
      - SPRING_DATASOURCE_URL=jdbc:postgresql://db/consent
      - SPRING_PROFILES_ACTIVE=dev
    depends_on:
      - db
  db:
    image: centos/postgresql-10-centos7
    environment:
      - POSTGRESQL_USER=cms
      - POSTGRESQL_PASSWORD=cms
      - POSTGRESQL_DATABASE=consent
    ports:
      - "5432:5432"
  ssl-proxy:
    build: ssl-proxy
    image: adorsys/psd2-sandbox-ssl-proxy
    environment:
      - API_INTERNAL_URL=${API_INTERNAL_URL:-http://service:8080}
      - API_EXTERNAL_URL=${API_EXTERNAL_URL:-api.psd2-accelerator.vcap.me}
      - PORTAL_INTERNAL_URL=${PORTAL_INTERNAL_URL:-http://service:8081}
      - PORTAL_EXTERNAL_URL=${PORTAL_EXTERNAL_URL:-portal.psd2-accelerator.vcap.me}
    ports:
      - "8443:8443"
    depends_on:
      - service</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_openshift_deployment_config">1.7.2. OpenShift Deployment Config</h4>
<div class="paragraph">
<p>This is an excerpt of the adorsys OpenShift deployment on <a href="https://sandbox-api.dev.adorsys.de" class="bare">https://sandbox-api.dev.adorsys.de</a> and <a href="https://sandbox-portal.dev.adorsys.de" class="bare">https://sandbox-portal.dev.adorsys.de</a>. The PostgreSQL deployment we use is not shown here.</p>
</div>
<div class="listingblock">
<div class="title">sandbox-dc.yml</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: apps.openshift.io/v1
kind: DeploymentConfig
metadata:
  annotations:
    openshift.io/generated-by: OpenShiftWebConsole
  labels:
    app: psd2-sandbox
  name: psd2-sandbox
  namespace: psd2-sandbox-dev
spec:
  replicas: 2
  selector:
    app: psd2-sandbox
    deploymentconfig: psd2-sandbox
  strategy:
    activeDeadlineSeconds: 21600
    resources: {}
    rollingParams:
      intervalSeconds: 1
      maxSurge: 25%
      maxUnavailable: 25%
      timeoutSeconds: 600
      updatePeriodSeconds: 1
    type: Rolling
  template:
    metadata:
      annotations:
        openshift.io/generated-by: OpenShiftWebConsole
      creationTimestamp: null
      labels:
        app: psd2-sandbox
        deploymentconfig: psd2-sandbox
    spec:
      containers:
        - env:
            - name: SPRING_DATASOURCE_URL
              value: 'jdbc:postgresql://db/consent'
            - name: CERTIFICATE_FILTER
              value: tab
            - name: SPRING_PROFILES_ACTIVE
              value: dev
            - name: SANDBOX_FEATURE_UI_ENABLED
              value: 'true'
            - name: BANK_PROFILE_PATH
              value: /data/bank_profile.yaml
          image: "psd2-sandbox-dev/psd2-sandbox-ssl-proxy:latest"
          imagePullPolicy: Always
          livenessProbe:
            failureThreshold: 3
            httpGet:
              path: /management/health
              port: 8081
              scheme: HTTP
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 1
          name: psd2-sandbox
          ports:
            - containerPort: 8080
              protocol: TCP
          readinessProbe:
            failureThreshold: 3
            httpGet:
              path: /management/health
              port: 8081
              scheme: HTTP
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 1
          resources:
            limits:
              memory: 768Mi
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
            - mountPath: /data
              name: volume-vvjnf
        - env:
            - name: API_INTERNAL_URL
              value: 'http://localhost:8080'
            - name: API_EXTERNAL_URL
              value: sandbox-api.dev.adorsys.de
            - name: PORTAL_INTERNAL_URL
              value: 'http://localhost:8081'
            - name: PORTAL_EXTERNAL_URL
              value: sandbox-portal.dev.adorsys.de
          image: "psd2-sandbox-dev/psd2-sandbox-ssl-proxy:latest"
          imagePullPolicy: Always
          livenessProbe:
            failureThreshold: 3
            httpGet:
              path: /healthz
              port: 8090
              scheme: HTTP
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 1
          name: ssl-proxy
          ports:
            - containerPort: 8443
              protocol: TCP
          readinessProbe:
            failureThreshold: 3
            httpGet:
              path: /healthz
              port: 8090
              scheme: HTTP
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 1
          resources:
            limits:
              memory: 128Mi
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
            - mountPath: /opt/app-root/etc/nginx.pem
              name: nginx-certs
              readOnly: true
              subPath: tls.crt
            - mountPath: /opt/app-root/etc/nginx.key
              name: nginx-certs
              readOnly: true
              subPath: tls.key
            - mountPath: /data
              name: volume-vvjnf
      dnsPolicy: ClusterFirst
      restartPolicy: Always
      schedulerName: default-scheduler
      securityContext: {}
      terminationGracePeriodSeconds: 30
      volumes:
        - name: nginx-certs
          secret:
            defaultMode: 420
            secretName: dev.adorsys.de
        - configMap:
            defaultMode: 420
            name: bank-profile
          name: volume-vvjnf
  test: false
  triggers:
    - imageChangeParams:
        automatic: true
        containerNames:
          - psd2-sandbox
        from:
          kind: ImageStreamTag
          name: 'psd2-sandbox:latest'
          namespace: psd2-sandbox-dev
      type: ImageChange
    - imageChangeParams:
        automatic: true
        containerNames:
          - ssl-proxy
        from:
          kind: ImageStreamTag
          name: 'psd2-sandbox-ssl-proxy:latest'
          namespace: psd2-sandbox-dev
      type: ImageChange
    - type: ConfigChange</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">sandbox-svc.yml</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: Service
metadata:
  labels:
    app: psd2-sandbox
  name: psd2-sandbox
spec:
  ports:
  - name: 8443-tcp
    port: 8443
    protocol: TCP
    targetPort: 8443
  - name: 8080-tcp-api
    port: 8080
    protocol: TCP
    targetPort: 8080
  - name: 8081-tcp-portal
    port: 8081
    protocol: TCP
    targetPort: 8081
  selector:
    deploymentconfig: psd2-sandbox
  sessionAffinity: None
  type: ClusterIP</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">sandbox-route-api.yml</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: route.openshift.io/v1
kind: Route
metadata:
  labels:
    app: psd2-sandbox
  name: api
spec:
  host: sandbox-api.dev.adorsys.de
  port:
    targetPort: 8443-tcp
  tls:
    insecureEdgeTerminationPolicy: Redirect
    termination: passthrough
  to:
    kind: Service
    name: psd2-sandbox
    weight: 100
  wildcardPolicy: None</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">sandbox-route-portal.yml</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: route.openshift.io/v1
kind: Route
metadata:
  labels:
    app: psd2-sandbox
  name: portal
spec:
  host: sandbox-portal.dev.adorsys.de
  port:
    targetPort: 8443-tcp
  tls:
    insecureEdgeTerminationPolicy: Redirect
    termination: passthrough
  to:
    kind: Service
    name: psd2-sandbox
    weight: 100
  wildcardPolicy: None</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_nginx_ssl_configuration">1.7.3. NGINX SSL Configuration</h4>
<div class="listingblock">
<div class="title">Relevant Samples of our NGINX SSL Configuration</div>
<div class="content">
<pre class="highlight"><code># sandbox-xs2a-server.conf
server {
  # The Sandbox HTTPS server, which proxies our requests
  listen 8443 ssl;
  server_name $API_EXTERNAL_URL;

  ssl_protocols TLSv1.1 TLSv1.2;
  # ssl certificate
  ssl_certificate /opt/app-root/etc/nginx.pem;
  ssl_certificate_key /opt/app-root/etc/nginx.key;

  # client certificate
  ssl_client_certificate /opt/app-root/etc/ca.crt;
  # make verification optional, so XS2A validates the incoming certificates
  ssl_verify_client optional;

  location / {

    proxy_set_header        Host $host;
    proxy_set_header        X-Real-IP $remote_addr;
    proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header        X-Forwarded-Proto $scheme;
    proxy_set_header        tpp-qwac-certificate $ssl_client_cert;

    # Fix the "It appears that your reverse proxy set up is broken" error.
    proxy_pass          $API_INTERNAL_URL;

    # web sockets
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection $connection_upgrade;

    proxy_redirect      $API_INTERNAL_URL $API_EXTERNAL_URL;
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code># sandbox-portal-server.conf
server {
  # The Sandbox HTTPS server, which proxies our requests
  listen 8443 ssl;
  server_name $PORTAL_EXTERNAL_URL;

  ssl_protocols TLSv1.1 TLSv1.2;
  # ssl certificate
  ssl_certificate /opt/app-root/etc/nginx.pem;
  ssl_certificate_key /opt/app-root/etc/nginx.key;

  location / {

    proxy_set_header        Host $host;
    proxy_set_header        X-Real-IP $remote_addr;
    proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header        X-Forwarded-Proto $scheme;

    # Fix the "It appears that your reverse proxy set up is broken" error.
    proxy_pass          $PORTAL_INTERNAL_URL;

    # web sockets
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection $connection_upgrade;

    proxy_redirect      $PORTAL_INTERNAL_URL $PORTAL_EXTERNAL_URL;
  }
}</code></pre>
</div>
</div>
<hr>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This Deployment Documentation is extracted from the PSD2 Accelerator Architecture Documentation and uses the arc42 template.
</td>
</tr>
</table>
</div>
<hr>
<div class="paragraph">
<p><strong>About arc42</strong></p>
</div>
<div class="paragraph lead">
<p>arc42, the Template for documentation of
software and system architecture.</p>
</div>
<div class="paragraph">
<p>By Dr. Gernot Starke, Dr. Peter Hruschka and contributors.</p>
</div>
<div class="paragraph">
<p>Template Revision: 7.0 EN (based on asciidoc), January 2017</p>
</div>
<div class="paragraph">
<p>&#169;
We acknowledge that this document uses material from the
arc 42 architecture template, <a href="http://www.arc42.de" class="bare">http://www.arc42.de</a>.
Created by Dr. Peter Hruschka &amp; Dr. Gernot Starke.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version <br>
Last updated 2019-03-25 10:15:58 CET
</div>
</div>
</body>
</html>